<section class="contact-dashboard" aria-label="Contacts Dashboard">
  <h1>Contacts Dashboard</h1>

  <!-- Add Contact Form -->
  <form (ngSubmit)="addContact()" aria-label="Add new contact" #addContactForm="ngForm" class="add-contact-form">
    <fieldset>
      <legend>Add New Contact</legend>

      <mat-form-field appearance="outline" class="inline-field">
        <mat-label>Name</mat-label>
        <input matInput name="newName" [(ngModel)]="newContact.name" required aria-required="true" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="inline-field">
        <mat-label>Phone</mat-label>
        <input matInput name="newPhone" [(ngModel)]="newContact.phone" required aria-required="true" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Address</mat-label>
        <input matInput name="newAddress" [(ngModel)]="newContact.address" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Notes</mat-label>
        <textarea matInput rows="3" name="newNotes" [(ngModel)]="newContact.notes"></textarea>
      </mat-form-field>

      <button mat-flat-button color="primary" type="submit" [disabled]="addContactForm.invalid">
        Add Contact
      </button>
    </fieldset>
  </form>

  <div *ngIf="isLoading" class="loading-container" role="status" aria-live="polite" aria-busy="true">
    <mat-progress-spinner
      mode="indeterminate"
      diameter="60"
      strokeWidth="5"
      color="primary"
      aria-label="Loading contacts"
    ></mat-progress-spinner>
    <p>Loading contacts...</p>
  </div>

  <ul *ngIf="!isLoading" class="contacts-list" role="list">
    <li *ngFor="let contact of contacts" class="contact-card" role="listitem">
      <mat-card>
        <!-- Show normal view if not editing this contact -->
        <div *ngIf="editingId !== contact._id; else editTemplate">
          <mat-card-header>
            <mat-card-title>{{ contact.name }}</mat-card-title>
            <mat-card-subtitle>{{ contact.phone }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <p><strong>Address:</strong> {{ contact.address }}</p>
            <p><strong>Notes:</strong> {{ contact.notes }}</p>
          </mat-card-content>

          <mat-card-actions>
            <button
              mat-icon-button
              color="primary"
              (click)="startEdit(contact)"
              [attr.aria-label]="'Edit contact ' + contact.name"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <button
              mat-icon-button
              color="warn"
              (click)="deleteContact(contact._id)"
              [attr.aria-label]="'Delete contact ' + contact.name"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card-actions>
        </div>

        <!-- Inline edit form -->
        <ng-template #editTemplate>
          <mat-card-header>
            <mat-form-field appearance="outline" class="inline-field">
              <mat-label>Name</mat-label>
              <input
                matInput
                [(ngModel)]="editableContact.name"
                name="name"
                required
                aria-required="true"
              />
            </mat-form-field>

            <mat-form-field appearance="outline" class="inline-field">
              <mat-label>Phone</mat-label>
              <input
                matInput
                [(ngModel)]="editableContact.phone"
                name="phone"
                required
                aria-required="true"
              />
            </mat-form-field>
          </mat-card-header>

          <mat-card-content>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Address</mat-label>
              <input
                matInput
                [(ngModel)]="editableContact.address"
                name="address"
              />
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Notes</mat-label>
              <textarea
                matInput
                rows="3"
                [(ngModel)]="editableContact.notes"
                name="notes"
              ></textarea>
            </mat-form-field>
          </mat-card-content>

          <mat-card-actions>
            <button mat-flat-button color="primary" (click)="saveEdit(editingId)">
              Save
            </button>
            <button mat-stroked-button color="warn" (click)="cancelEdit()">
              Cancel
            </button>
          </mat-card-actions>
        </ng-template>
      </mat-card>
    </li>
  </ul>
</section>
